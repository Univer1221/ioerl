<div class="modal-overlay" *ngIf="isOpen" (click)="close()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <!-- Modal Header -->
        <div class="modal-header">
            <h5 class="modal-title">
                <i class="fas fa-envelope-open-text"></i> Email Details
            </h5>
            <button class="btn-close" (click)="close()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
            <!-- Loading State -->
            <div class="loading-state" *ngIf="isLoading">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Loading email details...</span>
            </div>

            <!-- Error State -->
            <div class="error-state" *ngIf="errorMessage && !isLoading">
                <i class="fas fa-exclamation-circle"></i>
                <span>{{ errorMessage }}</span>
            </div>

            <!-- Email Details -->
            <div class="email-details" *ngIf="emailDetail && !isLoading && !errorMessage">
                <!-- Status Badge -->
                <div class="status-section">
                    <span class="status-badge" [ngClass]="getStatusClass(emailDetail.status)">
                        <i class="fas" [ngClass]="{
                            'fa-check-circle': emailDetail.status === 'Sent',
                            'fa-clock': emailDetail.status === 'Pending',
                            'fa-times-circle': emailDetail.status !== 'Sent' && emailDetail.status !== 'Pending'
                        }"></i>
                        {{ emailDetail.status }}
                    </span>
                    <span class="service-badge" *ngIf="emailDetail.serviceName">
                        <i class="fas fa-server"></i> {{ emailDetail.serviceName }}
                    </span>
                </div>

                <!-- Basic Info Section -->
                <div class="info-section">
                    <h6 class="section-title"><i class="fas fa-info-circle"></i> Basic Information</h6>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Application</label>
                            <span>{{ emailDetail.appName || 'N/A' }}</span>
                        </div>
                        <div class="info-item">
                            <label>Owner's UPN</label>
                            <span>{{ emailDetail.upn || 'N/A' }}</span>
                        </div>
                        <div class="info-item">
                            <label>Username</label>
                            <span>{{ emailDetail.username || 'N/A' }}</span>
                        </div>
                        <div class="info-item">
                            <label>Priority</label>
                            <span>{{ emailDetail.priority || 'Normal' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Sender/Recipient Section -->
                <div class="info-section">
                    <h6 class="section-title"><i class="fas fa-users"></i> Sender & Recipients</h6>
                    <div class="info-grid">
                        <div class="info-item full-width">
                            <label>From</label>
                            <span>{{ emailDetail.senderFrom || 'N/A' }}</span>
                        </div>
                        <div class="info-item full-width">
                            <label>To Recipients</label>
                            <span class="recipients-text">{{ emailDetail.recipients || 'N/A' }}</span>
                        </div>
                        <div class="info-item full-width" *ngIf="emailDetail.ccRecipients">
                            <label>CC Recipients</label>
                            <span class="recipients-text">{{ emailDetail.ccRecipients }}</span>
                        </div>
                        <div class="info-item full-width" *ngIf="emailDetail.bccRecipients">
                            <label>BCC Recipients</label>
                            <span class="recipients-text">{{ emailDetail.bccRecipients }}</span>
                        </div>
                    </div>
                </div>

                <!-- Subject Section -->
                <div class="info-section">
                    <h6 class="section-title"><i class="fas fa-heading"></i> Subject</h6>
                    <div class="subject-content">
                        {{ emailDetail.subject || 'No Subject' }}
                    </div>
                </div>

                <!-- Body Section -->
                <div class="info-section">
                    <h6 class="section-title">
                        <i class="fas fa-file-alt"></i> Body
                        <span class="html-badge" *ngIf="emailDetail.isHtmlBody">HTML</span>
                    </h6>
                    <div class="body-content" [class.html-body]="emailDetail.isHtmlBody">
                        <div *ngIf="emailDetail.isHtmlBody" [innerHTML]="emailDetail.body"></div>
                        <pre *ngIf="!emailDetail.isHtmlBody">{{ emailDetail.body || 'No content' }}</pre>
                    </div>
                </div>

                <!-- Error Section (if any) -->
                <div class="info-section error-section" *ngIf="emailDetail.errorMessage">
                    <h6 class="section-title"><i class="fas fa-exclamation-triangle"></i> Error Details</h6>
                    <div class="info-grid">
                        <div class="info-item" *ngIf="emailDetail.errorCode">
                            <label>Error Code</label>
                            <span class="error-code">{{ emailDetail.errorCode }}</span>
                        </div>
                        <div class="info-item full-width">
                            <label>Error Message</label>
                            <span class="error-message">{{ emailDetail.errorMessage }}</span>
                        </div>
                    </div>
                </div>

                <!-- Timestamps Section -->
                <div class="info-section">
                    <h6 class="section-title"><i class="fas fa-clock"></i> Timestamps</h6>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Created</label>
                            <span>{{ formatDate(emailDetail.createdDateTime) }}</span>
                        </div>
                        <div class="info-item">
                            <label>Sent</label>
                            <span>{{ formatDate(emailDetail.sentDateTime) }}</span>
                        </div>
                        <div class="info-item" *ngIf="emailDetail.scheduledDateTime">
                            <label>Scheduled</label>
                            <span>{{ formatDate(emailDetail.scheduledDateTime) }}</span>
                        </div>
                        <div class="info-item" *ngIf="emailDetail.modifiedDateTime">
                            <label>Modified</label>
                            <span>{{ formatDate(emailDetail.modifiedDateTime) }}</span>
                        </div>
                    </div>
                </div>

                <!-- Attachments Section -->
                <div class="info-section" *ngIf="emailDetail.emailAttachments && emailDetail.emailAttachments.length > 0">
                    <h6 class="section-title"><i class="fas fa-paperclip"></i> Attachments ({{ emailDetail.emailAttachments.length }})</h6>
                    <div class="attachments-list">
                        <div class="attachment-item" *ngFor="let attachment of emailDetail.emailAttachments">
                            <i class="fas fa-file"></i>
                            <span>{{ attachment.attachmentName }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
            <button class="btn-secondary" (click)="close()">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
    </div>
</div>
