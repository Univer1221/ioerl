<div class="container-fluid animate-fade-in py-2" *ngIf="userProfile">
    <!-- Welcome Header - Full Width -->
    <div class="card shadow-sm border-0 mb-2 dashboard-header-card glass-panel">
        <div class="card-body p-2">
            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                <div>
                    <h5 class="mb-1 text-dark font-weight-bold">
                        Welcome, <span class="text-primary">{{ userProfile.email.split('@')[0] }}</span>
                    </h5>
                    <p class="text-muted smallest mb-0">Monitor and manage your application's email metrics</p>
                </div>
                <div class="mt-2 mt-md-0 d-flex align-items-center gap-2">
                    <ng-select id="appSelectUser" name="appSelectUser" [(ngModel)]="selectedAppId" 
                               [items]="emailCount" bindLabel="appName" bindValue="appId"
                               (change)="onchangeApp($event)" [clearable]="false" [appendTo]="'body'"
                               class="custom-ng-select-sm app-select-dropdown" placeholder="Select Application">
                    </ng-select>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row with Profile Sidebar -->
    <div class="row">
        <div class="col-xl-9 col-lg-8">
            <div class="row">
                <div class="col-xl-8">
                    <div class="card shadow-sm mb-2 animate-fade-in animation-delay-1 border-0 h-100">
                        <div class="card-header bg-white py-2 border-0">
                            <h6 class="m-0 font-weight-bold text-primary smallest text-uppercase letter-spacing-1">Delivery Volume</h6>
                        </div>
                        <div class="card-body p-1">
                            <div class="chart-area chart-area-user">
                                <canvas id="myChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card shadow-sm mb-2 animate-fade-in animation-delay-2 border-0 h-100">
                        <div class="card-header bg-white py-2 border-0">
                            <h6 class="m-0 font-weight-bold text-primary smallest text-uppercase letter-spacing-1">Period Breakdown</h6>
                        </div>
                        <div class="card-body p-1">
                            <div class="chart-area chart-area-user">
                                <canvas id="breakdownChartUser"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-4">
            <div class="card shadow-sm border-0 mb-2 animate-fade-in animation-delay-1 text-center h-100 profile-card-gradient">
                <div class="card-body p-3 d-flex flex-column justify-content-center">
                    <p class="text-muted smallest mb-1">Good day!</p>
                    <h6 class="font-weight-bold text-dark mb-2">{{ userProfile.email.split('@')[0] | titlecase }}</h6>
                    <div class="position-relative d-inline-block mb-2">
                        <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto overflow-hidden profile-avatar">
                            <img [src]="userProfileImage" alt="Profile" class="profile-avatar-img">
                        </div>
                    </div>
                    <div class="text-start">
                        <div class="d-flex justify-content-between align-items-center py-1 border-bottom">
                            <span class="d-flex align-items-center">
                                <span class="badge bg-purple me-2 status-dot"></span>
                                <span class="smallest text-muted">Applications</span>
                            </span>
                            <span class="font-weight-bold text-dark">{{ totalApplications }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center py-1 border-bottom">
                            <span class="d-flex align-items-center">
                                <span class="badge bg-warning me-2 status-dot"></span>
                                <span class="smallest text-muted">Emails Sent</span>
                            </span>
                            <span class="font-weight-bold text-dark">{{ totalSentEmail }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center py-1 border-bottom">
                            <span class="d-flex align-items-center">
                                <span class="badge bg-success me-2 status-dot"></span>
                                <span class="smallest text-muted">This Month</span>
                            </span>
                            <span class="font-weight-bold text-dark">{{ monthlyEmail }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center py-1">
                            <span class="d-flex align-items-center">
                                <span class="badge bg-info me-2 status-dot"></span>
                                <span class="smallest text-muted">Member Since</span>
                            </span>
                            <span class="font-weight-bold text-dark">{{ userProfile.creationDateTime | date:'MMM yyyy' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Applications Table - Full Width -->
    <div class="card shadow-sm border-0 animate-fade-in animation-delay-3">
        <div class="card-header bg-white py-2 border-0">
            <h6 class="m-0 font-weight-bold text-primary smallest text-uppercase letter-spacing-1">
                <i class="fas fa-chart-bar me-2 text-warning"></i>Top 10 Application Utilisation
            </h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 smallest">
                    <thead class="bg-light">
                        <tr>
                            <th class="border-0 py-2 px-3 text-muted">Application & Description</th>
                            <th class="border-0 py-2 px-3 text-muted">Ownership</th>
                            <th class="border-0 py-2 px-3 text-muted text-center">Email Service</th>
                            <th class="border-0 py-2 px-3 text-muted text-center">Registry Date (UTC)</th>
                            <th class="border-0 py-2 px-3 text-muted text-center">Lifecycle</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let app of appList" class="align-middle">
                            <td class="py-2 px-3">
                                <div>
                                    <span class="font-weight-bold d-block">{{ app.appName }}</span>
                                    <span class="text-muted smallest">{{ app.description }}</span>
                                </div>
                            </td>
                            <td class="py-2 px-3">
                                <div>
                                    <span class="d-flex align-items-center">
                                        <i class="fas fa-user-circle text-muted me-1"></i> {{ app.appOwner }}
                                    </span>
                                    <span class="text-muted smallest">
                                        <i class="fas fa-at"></i> {{ app.fromEmailAddress }}
                                    </span>
                                </div>
                            </td>
                            <td class="py-2 px-3 text-center">
                                <span class="badge bg-info-soft text-info">
                                    <i class="fas fa-envelope me-1"></i>{{ app.emailServiceName || 'Unknown' }}
                                </span>
                            </td>
                            <td class="py-2 px-3 text-center">
                                <span class="smallest">{{ app.createdDateTime | date:'MMM dd, yyyy' }}</span>
                            </td>
                            <td class="py-2 px-3 text-center">
                                <span *ngIf="app.active === 1" class="badge bg-success-soft text-success">
                                    <i class="fas fa-check-circle me-1"></i>Active
                                </span>
                                <span *ngIf="app.active !== 1" class="badge bg-warning-soft text-warning">
                                    <i class="fas fa-pause-circle me-1"></i>Inactive
                                </span>
                            </td>
                        </tr>
                        <tr *ngIf="appList.length === 0">
                            <td colspan="5" class="text-center py-4 text-muted">
                                <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                                No applications registered yet
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
